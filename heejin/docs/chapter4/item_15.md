# 클래스와 인터페이스

[아이템 15. 클래스와 멤버의 접근 권한을 최소화하라](#클래스와-멤버의-접근-권한을-최소화하라)   
[- 기본 원칙](#기본-원칙)  
[- 모듈](#모듈)

<br>

## 클래스와 멤버의 접근 권한을 최소화하라
- 잘 설계된 컴포넌트는 모든 내부 구현을 완벽히 숨겨, 구현과 API를 깔끔히 분리한다.
- `정보 은닉`, 혹은 `캡슐화`라고 하는 이 개념은 소프트웨어 설계의 근간이 되는 원리다.

- 정보 은닉의 장점 
  - 시스템 개발 속도를 높인다.
  - 시스템 관리 비용을 낮춘다.
  - 다른 컴포넌트에 영향을 주지 않고 성능 최적화할 수 있다.
  - 소프트웨어의 재사용성을 높인다.
  - 큰 시스템을 제작하는 난이도를 낮춘다.

- 접근 제한자를 제대로 활용하는 것이 정보 은닉의 핵심이다.


### 기본 원칙
- **모든 클래스와 멤버의 접근성을 가능한 좁혀야 한다.**
  - 톱레벨 클래스와 인터페이스를 `public`으로 선언하면, 공개 API가 되며, `package-private`으로 선언하면 해당 패키지안에서만 이용할 수 있다.
  - 패키지 외부에서 쓸 일이 없다면, `package-private`으로 선언하는 것이 좋다. 
  - 공개 API가 되면 하위 호환을 위해 관리해주어야 하지만, 패키지 내부에서만 사용했다면 다음 릴리즈에서 수정, 교체, 제거할 수 있다.

- 한 클래스에서만 사용하는 `package-private` 클래스나 인터페이스는 이를 사용하는 클래스 안에 `private-static`으로 중첩시켜보자. *(→ item 24)*
    - 톱레벨로 두면 같은 패키지의 모든 클래스가 접근할 수 있지만, `private-static`으로 중첩시키면 바깥 클래스 하나에서만 접근할 수 있다. 

- 접근 제어자

    | | 같은 클래스 접근 | 같은 패키지 접근 | 상속 클래스 접근 | 외부 접근 |
    | :----- : | :-----: | :-----: | :-----: | :-----: |
    | public          | O | O | O | O |
    | protected       | O | O | O | X |
    | package-private | O | O | X | X |
    | private         | O | X | X | X |

- **클래스의 공개 API를 세심히 설계한 후, 그 외의 모든 멤버는 private으로 만들자.**
  - 공개 API외의 모든 멤버는 private로 만들고, 오직 같은 패키지의 다른 클래스가 접근해야하는 멤버에 한해 package-private로 풀어주는 것이 좋다.
  - 하지만, 권한을 풀어주는 일이 많아지면, 컴포넌트를 더 분리해야 하는 것은 아닌지 고민해 봐야 한다.
  - `Serializable`을 구현한 클래스에서는 그 필드들도 의도치 않게 공개 API가 될 수 있다. *(→ item 86, item 87)*

- public 클래스에서 멤버 접근 수준을 package-private에서 protected로 변경하는 순간 그 멤버에 접근할 수 있는 대상 범위가 엄청나게 넓어진다. 그러므로 protected 멤버는 적을 수록 좋다.

- 상위 클래스의 메서드를 재정의 할 때는 그 접근 수준을 상위 클래스에서보다 좁게 설정할 수 없다. (리스코프 치환 원칙)

- 테스트만을 위해 클래스, 인터페이스, 멤버를 공개 API로 만들어서는 안된다.

- public 클래스의 인스턴스 필드는 되도록 public이 아니어야한다. *(→ item 16)*
  - 필드가 가변 객체를 참조하거나, final이 아닌 인스턴스 필드를 public으로 선언하면, 그 필드에 담을 수 있는 값을 제한할 힘을 잃는다.
  - 즉, 불변식을 보장할 수 없게 된다.
  - 필드가 수정될 때 (락 획득 같은) 다른 작업을 할 수 없게 되므로, public 가변 필드를 갖는 클래스는 일반적으로 스레드 안정성이 없다.

- 이러한 문제는 정적 필드에서도 마찬가지이다. 
  - 하지만, 상수는 public static final 필드로 공개해도 좋다.

- 길이가 0이 아닌 배열은 모두 변경이 가능하니 주의해야 한다. 
  - 클래스에서 `public static final 배열 필드`를 두거나 이 필드를 반환하는 접근자 메서드를 제공하면 안된다.


### 모듈 
- Java 9에서는 모듈 시스템이라는 개념이 도입되면서, 암묵적 접근 수준이 추가되었다.
  - 이 암묵적 접근 수준들은 `public` 수준과 `protected` 수준과 같으나, 그 효과가 모듈 내부로 한정된다.
- 패키지가 클래스들의 묶음이듯, 모듈은 패키지들의 묶음이다.
- 모듈 시스템을 활용하면 클래스를 외부에 공개하지 않으면서도 같은 모듈을 이루는 패키지 사이에서 자유롭게 공유할 수 있다. 
  - 모듈은 자신에 속하는 패키지 중 공개(export)할 것들을 `module-info.java`에 선언한다.
  - protected 혹은 public 멤버라도 해당 패키지를 공개하지 않았다면 모듈 외부에서는 접근할 수 없다.
- 모듈의 JAR 파일을 자신의 모듈 경로가 아닌 애플리케이션의 클래스패스에 두면 그 모듈 안의 모든 패키지는 마치 모듈이 없는 것처럼 행동하므로 주의해야 한다.
  - 즉, 모듈이 공개했는지 여부와 상관없이, public 클래스가 선언한 모든 public 혹은 protected 멤버를 모듈 밖에서도 접근할 수 있게 된다.
- 모듈의 장점을 제대로 누리려면 해야 할 일이 많다.
  - 패키지들을 모듈 단위로 묶고, 모듈 선언에 패키지들의 모든 의존성을 명시해야한다.
  - 그런 다음 소스 트리를 재배치하고, 모듈 안에서 일반 패키지로의 모든 접근에 특별한 조치를 취해야 한다.


<br>

