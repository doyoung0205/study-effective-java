# 람다와 스트림

[아이템 45. 스트림은 주의해서 사용하라](#스트림은-주의해서-사용하라)  
[- 스트림 파이프라인](#스트림-파이프라인)  
[- 스트림의 사용](#스트림의-사용)  
[- 반복문과 다른 스트림의 특징](#반복문과-다른-스트림의-특징)  
[- 스트림을 사용하기 좋은 경우](#스트림을-사용하기-좋은-경우)  
[- 스트림을 사용하기 어려운 경우](#스트림을-사용하기-어려운-경우)  

<br>

## 스트림은 주의해서 사용하라
- 스트림 API는 다량의 데이터 처리 작업을 돕고자 자바 8에 추가되었다.

    > **스트림(stream)**  
    데이터 원소의 유한 혹은 무한 시퀀스를 뜻한다.  
  
    >**스트림 파이프라인(stream pipeline)**  
    스트림의 원소들로 수행하는 연산 단계를 표현하는 개념이다.


### 스트림 파이프라인
- 소스 스트림에서 시작해 종단연산으로 끝나며, 그 사이에 하나 이상의 중간 연산이 있을 수 있다.
- 중간 연산은 스트림을 어떠한 방식으로 변환한다.
- 종단 연산은 마지막 중간 연산이 내놓은 스트림에 최후 연산을 한다.
- **스트림 파이프라인은 지연 평가된다.**
  - **평가는 종단 연산이 호출될 때 이뤄지며, 종단 연산에 쓰이지 않는 데이터 원소는 계산에 쓰이지 않는다.**
  - 종단 연산이 없는 스트림 파이프라인은 아무 일도 하지 않는 명령어인 no-op과 같다.
- 스트림 API는 메서드 연쇄를 지원하는 플루언트 API다.
  - 즉, 파이프라인 하나를 구성하는 모든 호출을 연결하여 단 하나의 표현식으로 완성할 수 있다.
- 기본적으로 스트림 파이프라인은 순차적으로 수행된다.
  - 파이프라인을 병렬로 실행하려면 파이프라인을 구성하는 스트림 중 하나에서 `parallel` 메서드를 호출해주면 되지만, 효과를 볼 수 있는 상황은 많지 않다. (→ item48)


### 스트림의 사용
- 스트림을 과용하면 프로그램이 읽거나 유지보수하기 어려워진다.
  - [반복문을 사용한 예시](../../src/main/java/study/heejin/chapter7/item45/anagrams/IterativeAnagrams.java)
  - [스트림을 과하게 사용한 예시](../../src/main/java/study/heejin/chapter7/item45/anagrams/StreamAnagrams.java)
- char 값들을 처리할 때는 스트림을 삼가는 편이 낫다.
  - `"Hello world!".chars().forEach(System.out::print);`는 72101108... 값이기 때문에 형변환이 필요하다.
- 람다에서는 타입 이름을 자주 생략하므로 매개변수 이름을 잘 지어야 스트림 파이프라인의 가독성이 유지된다.
- 도우미 메서드를 적절히 활용하는 일의 중요성은 일반 반복 코드에서보다 스프림 파이프라인에서 더 크다.
  - [도우미 메서드와 스트림을 적절히 사용한 예시](../../src/main/java/study/heejin/chapter7/item45/anagrams/HybridAnagrams.java)


### 반복문과 다른 스트림의 특징
- 람다에서는 `final`인 변수만 읽을 수 있고, 지역변수를 수정하는 것은 불가능하다.
- `return`, `break`, `continue` 문으로 반복을 종료하거나 건너 뛸 수 없다. 
- 명시된 검사 예외를 던질 수 없다.


### 스트림을 사용하기 좋은 경우
- 원소들의 시퀀스를 일관되게 변환한다.
- 원소들의 시퀀스를 필터링한다.
- 원소들의 시퀀스를 하나의 연산을 사용해 결합한다. (더하기, 연결하기, 최솟값 구하기 등)
- 원소들의 시퀀스를 컬렉션에 모은다.
- 원소들의 시퀀스에서 특정 조건을 만족하는 원소를 찾는다.


### 스트림을 사용하기 어려운 경우
- 한 데이터가 파이프라인의 여러 단계를 통과할 때 각 단계에서 값들에 동시에 접근한다.
  - **스트림 파이프라인은 일단 한 값을 다른 값에 매핑하고 나면 원래의 값은 잃는 구조이기 때문이다.**
  - [메르센 소수 예시](../../src/main/java/study/heejin/chapter7/item45/MersennePrimes.java)
    - 메르센 소수 예시에서 지수(p)를 출력하려고 할 때, 결과를 출력하는 종단 연산에서는 접근할 수 없다.
    - 하지만 다행히 첫 번째 중간 연산에서 수행한 매핑을 거꾸로 수행해 메르센 수의 지수를 계산할 수 있다.  
      (지수는 숫자를 이진수로 표현한 다음 몇 비트인지를 세면 알 수 있다.)
  

<br>