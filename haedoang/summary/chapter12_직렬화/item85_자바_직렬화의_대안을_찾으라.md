## item85 자바 직렬화의 대안을 찾으라

### 직렬화/역직렬화는 언제 사용할까
- 다른 VM으로 전송 시 객체를 직렬화하여 바이트 스트림으로 전송한다
- 다른 VM에서 객체를 수신할 때 바이트 스트림을 객체로 역직렬화한다

### 직렬화는 공격 범위가 너무 넓고 방어하기가 어렵다
- `ObjectInputStream` 의 `readObject` 메서드는 객체 그래프가 역직렬화 된다
  - 클래스패스 안의 거의 모든 타입의 객체를 만들어 낼 수 있다
- 신뢰할 수 없는 스트림을 역직렬화하면 RCE, 서비스 거부 등의 공격이 이뤄질 수 있다

### 신중하게 제작한 바이트 스트림만 역직렬화해야 한다
- 역직렬화에 시간이 오래 걸리는 스트림을 `역직렬화 폭탄` 이라고 부른다

### 직렬화 위험을 피하는 가장 좋은 방법은 아무것도 역직렬화하지 않는 것이다

### 여러분이 작성하는 새로운 시스템에서 자바 직렬화를 써야할 이유가 전혀 없다

### 직렬화를 대신하는 JSON/프로토콜 버퍼
- JSON: 텍스트 기반, 데이터 표현만을 위함
- 프로토콜 버퍼: 이진 표현으로 효율이 높음, 문서를 위한 스키마(타입)을 제공

### 신뢰할 수 없는 데이터는 절대 역직렬화하지 말자
- 직렬화를 피할 수 없고 역직렬화된 데이터가 안전한지 확신할 수 없다면 객체 역직렬화 필터링(java.io.ObjectInputFilter)을 사용하자
  - 클래스 단위로 필터링
  - 블랙리스트, 화이트리스트 방식 => 화이트리스트 방식을 권장
     - 스왓(SWAT): 애플리케이션을 위한 화이트리스트를 자동으로 생성해주는 도구


### 정리
- 직렬화는 위험하니까 피하라.
- 시스템을 밑바닥부터 설계한다면 JSON 이나 프로토콜 버퍼와 같은 대안을 사용하자


