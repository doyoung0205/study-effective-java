## item 33 타입 안전 이종 컨테이너를 고려하라

##### 타입 안전 이종 컨테이너 패턴
- 컨테이너 대신 키를 매개변수화하여 컨테이너에 값을 넣거나 뺄 때 매개변수화된 키를 함께 제공하는 패턴
- 제한되지 않은 다양한 타입을 가질 경우 사용할 수 있다
- 자바의 타입을 key로 가지는 컨테이너 패턴으로 `값`의 타입 안정성을 `키`를 통해 보장할 수 있다
- 이 경우 타입 토큰을 키로 사용한다

##### 타입 토큰(type token)
- 컴파일 타임 타입정보와 런타임 타입 정보를 알아내기 위해 메서드들이 주고받는 class 리터럴
- `String.class`, `Favorites.class` ...

##### 타입 안정성을 위배하는 경우
- 로 타입을 사용하는 경우 타입 안정성을 위배할 수 있다
  - ex) putFavorites((Class)Integer.class, "not integer");
- 따라서 타입 안전 이종 컨테이너 내 객체를 넣을 때 실제 타입을 검증해야 한다
  - ex) favorites.put(Objects.requireNonNull(type), type.cast(instance)); 
  
##### 타입 토큰의 한계 
- 타입 토큰은 `Collection` 객체에서 사용하기에 다소 유용하지 못한 점이 있다
- 이러한 단점을 보완하기 위해 `슈퍼 타입 토큰`이라는 방법으로 시도하는 경우도 있다. 
  - 스프링 프레임워크에서 `ParameterizedTypeReference` 클래스 참조
  
##### 한정적 타입 토큰
- `애너테이션 API`가 대표적인 예이다
- `getAnnotationType()` 메서드는 토큰으로 명시한 타입의 애너테이션이 대상 요소에 달려 있는지 여부에 따라 애너테이션을 반환한다
- 즉, 애너테이션 유무에 따라 토큰을 제한할 수 있다
- `asSubclass()` 메서드를 통해 한정적 타입 토큰을 안정적으로 런타임 중에 변환할 수 있다


### 정리
- 한 컨테이너가 다룰 수 있는 타입 매개변수는 고정되어 있는데 컨테이너 자체가 아닌 키를 타입 매개변수로 변경하면 제약 없이 사용이 가능하다
- 타입 토큰을 키로 사용하여 value에 대한 타입 안정성을 보장할 수 있다