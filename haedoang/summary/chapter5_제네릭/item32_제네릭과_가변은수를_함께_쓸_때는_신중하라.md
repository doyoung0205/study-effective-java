## item 32 제네릭과 가변은수를 함께 쓸 때는 신중하라 

##### 가변인수(varargs) 메서드와 제네릭을 사용할 때는 주의해야 한다
- 가변인수 메서드를 호출하면 가변인수를 담기 위한 배열이 하나 자동으로 만들어진다
  - 자바 컴파일러는 모든 타입을 담기 위해 Object[] 타입으로 배열을 만든다
  - 제네릭 varargs 는 타입 안정성을 해치므로 해당 배열 매개변수에 값을 저장하는 것은 안전하지 못하다(ClassCastException) 
  - [https://www.baeldung.com/java-varargs](https://www.baeldung.com/java-varargs)
- 사용할 경우 타입 변환에 조심하여야 하며 타입 안정성을 보장해야 한다
- 자바는 제네릭과 가변인수를 함께 사용하는 것이 유용하기 때문에 컴파일러에서 타입 안정성에 대해 유연하게 체크한다(경고) 

##### 가변인수와 제네릭을 함께 쓰는 라이브러리 예시 (타입 안전하다)
  - Arrays.asList(T... a) 
  - Collections.addAll(Collection<? super T> c, T... eleement), ...
  - EnumSet.of(E first, E...)
  
##### 타입 안정성을 보장해주는 어노테이션 @SafeVarargs
- 메서드 작성자가 그 메서드가 타입 안전함을 보장하는 어노테이션이다
- 타입 안정성이 보장되는 경우에만 사용하도록 해야 한다

##### 제네릭 매개변수를 반환하는 경우 주의하라 
```java
static <T> T[] toArray(T... args) {
    return args;    
}
```
- 위의 코드는 반환 시 Object[] 을 반환하게 된다
- 컴파일러에게 충분한 정보가 주어지지 않았기 때문에 컴파일러는 모든 타입을 받을 수 있는 Object[] 타입으로 변환을 한다
- 힙오염, ClassCastException 발생에 주의해야 한다
- 제네릭 varargs 매개변수 배열에 다른 메서드가 접근하도록 허용하면 안전하지 않다
  - 예외1. `@SafeVarargs`로 제대로 애노테이트된 또 다른 varargs 메서드에 넘기는 것은 안전하다
  - 예외2. 배열 내용의 일부 함수를 호출만 하는 메서드에 넘기는 것도 안전하다
  - 즉 제네릭 varargs 매개변수 배열의 값을 캐스팅해서 꺼내거나 타입을 가공해서는 안된다는 뜻이다

#####  제네릭이나 매개변수화 타입의 varargs 매개변수를 받는 모든 메서드에 @SafeVarargs를 달아라
- 규칙1. varargs 매개변수 배열에 아무것도 저장하지 않는다 
- 규칙2. 그 배열(혹은 복제본)을 신뢰할 수 없는 코드에 노출하지 않는다

##### List.of를 사용하여 안정성을 보장하는 방법
- `List.of` 내부 구현에 `@SafeVarargs` 어노테이션이 작성되어있다. 리스트 방식으로도 작성하여 안정성을 보장할 수 있다 

### 정리 
- 가변인수 기능은 배열을 노출하여 추상화가 완벽하지 못하고, 배열과 제네릭의 타입 규칙이 서로 다르기 때문에 사용에 유의해야 한다
- 제네릭 varargs 매개변수는 타입 안전하지는 못하나 다방면에서 사용하기 좋기 때문에 허용된다
- 메서드에 제네릭 매개변수를 사용하고자 한다면 메서드가 타입 안전한지 확인 후 `@SafeVarargs`를 사용한다
